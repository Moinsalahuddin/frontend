{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\TECH FEVER\\\\Desktop\\\\Foxy\\\\LuxuryStay Hospitality\\\\LuxuryStay Hospitality\\\\frontend\\\\src\\\\components\\\\Chat.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useContext } from 'react';\nimport axios from 'axios';\nimport { AuthContext } from '../context/AuthContext.jsx';\nimport './Chat.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Chat = ({\n  isOpen,\n  onClose\n}) => {\n  _s();\n  var _selectedConversation2, _selectedConversation3, _selectedConversation4, _selectedConversation5, _selectedConversation6, _selectedConversation7, _selectedConversation8;\n  const {\n    user\n  } = useContext(AuthContext);\n  const [conversations, setConversations] = useState([]);\n  const [selectedConversation, setSelectedConversation] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [availableUsers, setAvailableUsers] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [sending, setSending] = useState(false);\n  const messagesEndRef = useRef(null);\n  const messagesContainerRef = useRef(null);\n  useEffect(() => {\n    if (isOpen && user) {\n      fetchConversations();\n      fetchAvailableUsers();\n      // Reset selected conversation when opening chat\n      setSelectedConversation(null);\n    }\n  }, [isOpen, user]);\n  useEffect(() => {\n    if (selectedConversation) {\n      fetchMessages(selectedConversation._id);\n      // Poll for new messages every 3 seconds\n      const interval = setInterval(() => {\n        fetchMessages(selectedConversation._id);\n      }, 3000);\n      return () => clearInterval(interval);\n    }\n  }, [selectedConversation]);\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n  const scrollToBottom = () => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  };\n  const fetchConversations = async () => {\n    try {\n      setLoading(true);\n      const response = await axios.get('/api/messages/conversations');\n      setConversations(response.data.conversations || []);\n      setLoading(false);\n    } catch (error) {\n      var _error$response;\n      console.error('Error fetching conversations:', error);\n      console.error('Error details:', (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data);\n      setConversations([]);\n      setLoading(false);\n    }\n  };\n  const fetchAvailableUsers = async () => {\n    try {\n      setLoading(true);\n      const response = await axios.get('/api/messages/users');\n      console.log('Available users response:', response.data);\n      console.log('Current user role:', user === null || user === void 0 ? void 0 : user.role);\n      setAvailableUsers(response.data.users || []);\n      setLoading(false);\n    } catch (error) {\n      var _error$response2, _error$response3;\n      console.error('Error fetching available users:', error);\n      console.error('Error details:', (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data);\n      console.error('Error status:', (_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.status);\n      setAvailableUsers([]);\n      setLoading(false);\n    }\n  };\n  const fetchMessages = async conversationId => {\n    try {\n      const response = await axios.get(`/api/messages/${conversationId}`);\n      setMessages(response.data.messages || []);\n    } catch (error) {\n      var _error$response4, _error$response5;\n      console.error('Error fetching messages:', error);\n      console.error('Error details:', (_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.data);\n      if (((_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : _error$response5.status) === 404) {\n        setMessages([]);\n      }\n    }\n  };\n  const startConversation = async userId => {\n    try {\n      const response = await axios.get(`/api/messages/conversation/${userId}`);\n      if (!response.data || !response.data.conversation) {\n        throw new Error('Invalid response from server');\n      }\n      const conversation = response.data.conversation;\n\n      // Find other participant - handle both populated and non-populated cases\n      let otherParticipant = null;\n      if (conversation.participants && conversation.participants.length > 0) {\n        otherParticipant = conversation.participants.find(p => {\n          var _p$_id, _user$_id, _user$_id2;\n          const participantId = ((_p$_id = p._id) === null || _p$_id === void 0 ? void 0 : _p$_id.toString()) || (p === null || p === void 0 ? void 0 : p.toString());\n          const currentUserId = ((_user$_id = user._id) === null || _user$_id === void 0 ? void 0 : _user$_id.toString()) || ((_user$_id2 = user._id) === null || _user$_id2 === void 0 ? void 0 : _user$_id2.toString());\n          return participantId !== currentUserId;\n        });\n      }\n      if (!otherParticipant) {\n        console.error('Other participant not found in conversation:', conversation);\n        // Try to get user info from availableUsers\n        const userInfo = availableUsers.find(u => u._id.toString() === userId);\n        if (userInfo) {\n          otherParticipant = userInfo;\n        }\n      }\n      setSelectedConversation({\n        ...conversation,\n        otherParticipant: otherParticipant\n      });\n      fetchMessages(conversation._id);\n    } catch (error) {\n      var _error$response6;\n      console.error('Error starting conversation:', error);\n      console.error('Error details:', (_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : _error$response6.data);\n      let errorMessage = 'Error getting conversation';\n      if (error.response) {\n        var _error$response$data, _error$response$data2;\n        // Server responded with error\n        errorMessage = ((_error$response$data = error.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || ((_error$response$data2 = error.response.data) === null || _error$response$data2 === void 0 ? void 0 : _error$response$data2.error) || `Error: ${error.response.status}`;\n      } else if (error.request) {\n        // Request made but no response\n        errorMessage = 'Network error. Please check your connection.';\n      } else {\n        // Something else happened\n        errorMessage = error.message || 'An unexpected error occurred';\n      }\n\n      // Show user-friendly error message\n      alert(errorMessage);\n    }\n  };\n  const sendMessage = async e => {\n    e.preventDefault();\n    if (!newMessage.trim() || sending) return;\n    if (!selectedConversation) {\n      alert('Please select a conversation first');\n      return;\n    }\n    setSending(true);\n    try {\n      var _selectedConversation;\n      // Get receiver ID - try multiple methods to ensure we get it\n      let receiverId = null;\n\n      // Method 1: From otherParticipant (most reliable)\n      if (selectedConversation !== null && selectedConversation !== void 0 && (_selectedConversation = selectedConversation.otherParticipant) !== null && _selectedConversation !== void 0 && _selectedConversation._id) {\n        receiverId = selectedConversation.otherParticipant._id;\n      }\n\n      // Method 2: From participants array (populated objects)\n      if (!receiverId && selectedConversation !== null && selectedConversation !== void 0 && selectedConversation.participants) {\n        const otherUser = selectedConversation.participants.find(p => {\n          var _p$_id2, _user$_id3;\n          const participantId = ((_p$_id2 = p._id) === null || _p$_id2 === void 0 ? void 0 : _p$_id2.toString()) || (p === null || p === void 0 ? void 0 : p._id) || (p === null || p === void 0 ? void 0 : p.toString());\n          const currentUserId = ((_user$_id3 = user._id) === null || _user$_id3 === void 0 ? void 0 : _user$_id3.toString()) || user._id;\n          return participantId && participantId !== currentUserId;\n        });\n        if (otherUser) {\n          var _otherUser$_id;\n          receiverId = otherUser._id || ((_otherUser$_id = otherUser._id) === null || _otherUser$_id === void 0 ? void 0 : _otherUser$_id.toString()) || otherUser;\n        }\n      }\n\n      // Method 3: If receiverId is still not found, try to extract from string IDs\n      if (!receiverId && selectedConversation !== null && selectedConversation !== void 0 && selectedConversation.participants) {\n        var _user$_id4;\n        const currentUserId = ((_user$_id4 = user._id) === null || _user$_id4 === void 0 ? void 0 : _user$_id4.toString()) || user._id;\n        for (const p of selectedConversation.participants) {\n          var _p$_id3;\n          const participantId = ((_p$_id3 = p._id) === null || _p$_id3 === void 0 ? void 0 : _p$_id3.toString()) || (p === null || p === void 0 ? void 0 : p._id) || (p === null || p === void 0 ? void 0 : p.toString());\n          if (participantId && participantId !== currentUserId) {\n            receiverId = participantId;\n            break;\n          }\n        }\n      }\n\n      // Ensure receiverId is a string if found\n      if (receiverId && typeof receiverId !== 'string') {\n        receiverId = receiverId.toString();\n      }\n\n      // Prepare request payload - backend can extract receiverId from conversationId if needed\n      const requestPayload = {\n        conversationId: selectedConversation._id,\n        message: newMessage\n      };\n\n      // Add receiverId if we found it, but backend can handle without it\n      if (receiverId) {\n        requestPayload.receiverId = receiverId;\n      } else {\n        console.warn('ReceiverId not found, but sending with conversationId only. Backend will extract it.');\n      }\n      console.log('Sending message with payload:', requestPayload);\n      const response = await axios.post('/api/messages', requestPayload);\n      setMessages(prev => [...prev, response.data.message]);\n      setNewMessage('');\n      fetchConversations(); // Refresh conversations list\n      // Refresh messages to get updated list\n      fetchMessages(selectedConversation._id);\n    } catch (error) {\n      var _error$response7, _error$response8, _error$response8$data;\n      console.error('Error sending message:', error);\n      console.error('Error details:', (_error$response7 = error.response) === null || _error$response7 === void 0 ? void 0 : _error$response7.data);\n      alert(((_error$response8 = error.response) === null || _error$response8 === void 0 ? void 0 : (_error$response8$data = _error$response8.data) === null || _error$response8$data === void 0 ? void 0 : _error$response8$data.message) || 'Error sending message');\n    } finally {\n      setSending(false);\n    }\n  };\n  const formatTime = date => {\n    const messageDate = new Date(date);\n    const now = new Date();\n    const diff = now - messageDate;\n    const minutes = Math.floor(diff / 60000);\n    if (minutes < 1) return 'Just now';\n    if (minutes < 60) return `${minutes}m ago`;\n    if (minutes < 1440) return `${Math.floor(minutes / 60)}h ago`;\n    return messageDate.toLocaleDateString();\n  };\n  useEffect(() => {\n    if (isOpen) {\n      document.body.style.overflow = 'hidden';\n      document.documentElement.style.overflow = 'hidden';\n      document.body.classList.add('chat-open');\n      document.documentElement.classList.add('chat-open');\n    } else {\n      document.body.style.overflow = '';\n      document.documentElement.style.overflow = '';\n      document.body.classList.remove('chat-open');\n      document.documentElement.classList.remove('chat-open');\n    }\n    return () => {\n      document.body.style.overflow = '';\n      document.documentElement.style.overflow = '';\n      document.body.classList.remove('chat-open');\n      document.documentElement.classList.remove('chat-open');\n    };\n  }, [isOpen]);\n  if (!isOpen) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-overlay\",\n    onClick: onClose,\n    style: {\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      zIndex: 999999,\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      height: '100vh',\n      width: '100vw'\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-container\",\n      onClick: e => e.stopPropagation(),\n      style: {\n        position: 'fixed',\n        top: '50%',\n        left: '50%',\n        transform: 'translate(-50%, -50%)',\n        zIndex: 1000000,\n        margin: 0\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Messages\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"chat-close-btn\",\n          onClick: onClose,\n          children: \"\\xD7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 295,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-sidebar\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-sidebar-header\",\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              children: \"Conversations\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn btn-primary btn-sm\",\n              onClick: () => setSelectedConversation(null),\n              children: \"New Chat\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 303,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 301,\n            columnNumber: 13\n          }, this), loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-empty\",\n            children: \"Loading...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 15\n          }, this) : !selectedConversation ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-users-list\",\n            children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n              children: \"Start a conversation:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 315,\n              columnNumber: 17\n            }, this), availableUsers.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-empty\",\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"No users available to chat\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 318,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                style: {\n                  fontSize: '12px',\n                  marginTop: '8px',\n                  color: '#999'\n                },\n                children: (user === null || user === void 0 ? void 0 : user.role) === 'receptionist' ? 'No guests available' : (user === null || user === void 0 ? void 0 : user.role) === 'guest' ? 'No receptionists available' : 'No users found'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 319,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 317,\n              columnNumber: 19\n            }, this) : availableUsers.map(userItem => {\n              var _userItem$firstName, _userItem$lastName;\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"chat-user-item\",\n                onClick: () => startConversation(userItem._id),\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"chat-user-avatar\",\n                  children: [(_userItem$firstName = userItem.firstName) === null || _userItem$firstName === void 0 ? void 0 : _userItem$firstName[0], (_userItem$lastName = userItem.lastName) === null || _userItem$lastName === void 0 ? void 0 : _userItem$lastName[0]]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 332,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"chat-user-info\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"chat-user-name\",\n                    children: [userItem.firstName, \" \", userItem.lastName]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 336,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"chat-user-role\",\n                    children: userItem.role\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 339,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 335,\n                  columnNumber: 23\n                }, this)]\n              }, userItem._id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 327,\n                columnNumber: 21\n              }, this);\n            })]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 314,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-conversations-list\",\n            children: conversations.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"chat-empty\",\n              children: \"No conversations yet\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 348,\n              columnNumber: 19\n            }, this) : conversations.map(conv => {\n              var _otherUser$firstName, _otherUser$lastName;\n              const otherUser = conv.otherParticipant || conv.participants.find(p => p._id.toString() !== user._id.toString());\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: `chat-conversation-item ${(selectedConversation === null || selectedConversation === void 0 ? void 0 : selectedConversation._id) === conv._id ? 'active' : ''}`,\n                onClick: async () => {\n                  // Ensure otherParticipant is properly set\n                  let finalOtherUser = otherUser;\n                  if (!finalOtherUser && conv.participants) {\n                    finalOtherUser = conv.participants.find(p => {\n                      var _p$_id4, _user$_id5;\n                      const participantId = ((_p$_id4 = p._id) === null || _p$_id4 === void 0 ? void 0 : _p$_id4.toString()) || (p === null || p === void 0 ? void 0 : p._id) || (p === null || p === void 0 ? void 0 : p.toString());\n                      const currentUserId = ((_user$_id5 = user._id) === null || _user$_id5 === void 0 ? void 0 : _user$_id5.toString()) || user._id;\n                      return participantId && participantId !== currentUserId;\n                    });\n                  }\n                  const updatedConversation = {\n                    ...conv,\n                    otherParticipant: finalOtherUser,\n                    _id: conv._id\n                  };\n                  console.log('Selected conversation:', updatedConversation);\n                  setSelectedConversation(updatedConversation);\n                  fetchMessages(conv._id);\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"chat-user-avatar\",\n                  children: [otherUser === null || otherUser === void 0 ? void 0 : (_otherUser$firstName = otherUser.firstName) === null || _otherUser$firstName === void 0 ? void 0 : _otherUser$firstName[0], otherUser === null || otherUser === void 0 ? void 0 : (_otherUser$lastName = otherUser.lastName) === null || _otherUser$lastName === void 0 ? void 0 : _otherUser$lastName[0]]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 384,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"chat-conversation-info\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"chat-conversation-header\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"chat-conversation-name\",\n                      children: [otherUser === null || otherUser === void 0 ? void 0 : otherUser.firstName, \" \", otherUser === null || otherUser === void 0 ? void 0 : otherUser.lastName]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 389,\n                      columnNumber: 29\n                    }, this), conv.unreadCount > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"chat-unread-badge\",\n                      children: conv.unreadCount\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 393,\n                      columnNumber: 31\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 388,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"chat-conversation-preview\",\n                    children: conv.lastMessage || 'No messages yet'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 396,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 387,\n                  columnNumber: 25\n                }, this)]\n              }, conv._id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 355,\n                columnNumber: 23\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 346,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-messages-area\",\n          children: selectedConversation ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-messages-header\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"chat-messages-user\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"chat-user-avatar\",\n                  children: [(_selectedConversation2 = selectedConversation.otherParticipant) === null || _selectedConversation2 === void 0 ? void 0 : (_selectedConversation3 = _selectedConversation2.firstName) === null || _selectedConversation3 === void 0 ? void 0 : _selectedConversation3[0], (_selectedConversation4 = selectedConversation.otherParticipant) === null || _selectedConversation4 === void 0 ? void 0 : (_selectedConversation5 = _selectedConversation4.lastName) === null || _selectedConversation5 === void 0 ? void 0 : _selectedConversation5[0]]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 414,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"chat-messages-name\",\n                    children: [(_selectedConversation6 = selectedConversation.otherParticipant) === null || _selectedConversation6 === void 0 ? void 0 : _selectedConversation6.firstName, ' ', (_selectedConversation7 = selectedConversation.otherParticipant) === null || _selectedConversation7 === void 0 ? void 0 : _selectedConversation7.lastName]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 419,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"chat-messages-role\",\n                    children: (_selectedConversation8 = selectedConversation.otherParticipant) === null || _selectedConversation8 === void 0 ? void 0 : _selectedConversation8.role\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 423,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 418,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 413,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 412,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-messages-list\",\n              ref: messagesContainerRef,\n              children: [messages.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"chat-empty-messages\",\n                children: \"No messages yet. Start the conversation!\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 432,\n                columnNumber: 21\n              }, this) : messages.map(message => {\n                const isOwn = message.senderId._id === user._id;\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: `chat-message ${isOwn ? 'own' : 'other'}`,\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"chat-message-content\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"chat-message-text\",\n                      children: message.message\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 444,\n                      columnNumber: 29\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"chat-message-time\",\n                      children: formatTime(message.createdAt)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 445,\n                      columnNumber: 29\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 443,\n                    columnNumber: 27\n                  }, this)\n                }, message._id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 439,\n                  columnNumber: 25\n                }, this);\n              }), /*#__PURE__*/_jsxDEV(\"div\", {\n                ref: messagesEndRef\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 453,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 430,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n              className: \"chat-input-form\",\n              onSubmit: sendMessage,\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                className: \"chat-input\",\n                placeholder: \"Type a message...\",\n                value: newMessage,\n                onChange: e => setNewMessage(e.target.value),\n                disabled: sending\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 457,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"submit\",\n                className: \"chat-send-btn\",\n                disabled: !newMessage.trim() || sending,\n                children: \"Send\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 465,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 456,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chat-welcome\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"chat-welcome-icon\",\n              children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                width: \"48\",\n                height: \"48\",\n                viewBox: \"0 0 24 24\",\n                fill: \"none\",\n                xmlns: \"http://www.w3.org/2000/svg\",\n                children: [/*#__PURE__*/_jsxDEV(\"path\", {\n                  d: \"M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H6L4 18V4H20V16Z\",\n                  fill: \"currentColor\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 478,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n                  d: \"M7 9H17V11H7V9ZM7 12H15V14H7V12Z\",\n                  fill: \"currentColor\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 479,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 477,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 476,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Select a conversation or start a new one\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 482,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"Choose from the list on the left to view and send messages\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 483,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 475,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 409,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 264,\n    columnNumber: 5\n  }, this);\n};\n_s(Chat, \"RTvCz/b6fmj6tiF/SxI5yHja8ck=\");\n_c = Chat;\nexport default Chat;\nvar _c;\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useContext","axios","AuthContext","jsxDEV","_jsxDEV","Fragment","_Fragment","Chat","isOpen","onClose","_s","_selectedConversation2","_selectedConversation3","_selectedConversation4","_selectedConversation5","_selectedConversation6","_selectedConversation7","_selectedConversation8","user","conversations","setConversations","selectedConversation","setSelectedConversation","messages","setMessages","newMessage","setNewMessage","availableUsers","setAvailableUsers","loading","setLoading","sending","setSending","messagesEndRef","messagesContainerRef","fetchConversations","fetchAvailableUsers","fetchMessages","_id","interval","setInterval","clearInterval","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","response","get","data","error","_error$response","console","log","role","users","_error$response2","_error$response3","status","conversationId","_error$response4","_error$response5","startConversation","userId","conversation","Error","otherParticipant","participants","length","find","p","_p$_id","_user$_id","_user$_id2","participantId","toString","currentUserId","userInfo","u","_error$response6","errorMessage","_error$response$data","_error$response$data2","message","request","alert","sendMessage","e","preventDefault","trim","_selectedConversation","receiverId","otherUser","_p$_id2","_user$_id3","_otherUser$_id","_user$_id4","_p$_id3","requestPayload","warn","post","prev","_error$response7","_error$response8","_error$response8$data","formatTime","date","messageDate","Date","now","diff","minutes","Math","floor","toLocaleDateString","document","body","style","overflow","documentElement","classList","add","remove","className","onClick","position","top","left","right","bottom","zIndex","display","alignItems","justifyContent","height","width","children","stopPropagation","transform","margin","fileName","_jsxFileName","lineNumber","columnNumber","fontSize","marginTop","color","map","userItem","_userItem$firstName","_userItem$lastName","firstName","lastName","conv","_otherUser$firstName","_otherUser$lastName","finalOtherUser","_p$_id4","_user$_id5","updatedConversation","unreadCount","lastMessage","ref","isOwn","senderId","createdAt","onSubmit","type","placeholder","value","onChange","target","disabled","viewBox","fill","xmlns","d","_c","$RefreshReg$"],"sources":["C:/Users/TECH FEVER/Desktop/Foxy/LuxuryStay Hospitality/LuxuryStay Hospitality/frontend/src/components/Chat.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useContext } from 'react';\nimport axios from 'axios';\nimport { AuthContext } from '../context/AuthContext.jsx';\nimport './Chat.css';\n\nconst Chat = ({ isOpen, onClose }) => {\n  const { user } = useContext(AuthContext);\n  const [conversations, setConversations] = useState([]);\n  const [selectedConversation, setSelectedConversation] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [availableUsers, setAvailableUsers] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [sending, setSending] = useState(false);\n  const messagesEndRef = useRef(null);\n  const messagesContainerRef = useRef(null);\n\n  useEffect(() => {\n    if (isOpen && user) {\n      fetchConversations();\n      fetchAvailableUsers();\n      // Reset selected conversation when opening chat\n      setSelectedConversation(null);\n    }\n  }, [isOpen, user]);\n\n  useEffect(() => {\n    if (selectedConversation) {\n      fetchMessages(selectedConversation._id);\n      // Poll for new messages every 3 seconds\n      const interval = setInterval(() => {\n        fetchMessages(selectedConversation._id);\n      }, 3000);\n      return () => clearInterval(interval);\n    }\n  }, [selectedConversation]);\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  const fetchConversations = async () => {\n    try {\n      setLoading(true);\n      const response = await axios.get('/api/messages/conversations');\n      setConversations(response.data.conversations || []);\n      setLoading(false);\n    } catch (error) {\n      console.error('Error fetching conversations:', error);\n      console.error('Error details:', error.response?.data);\n      setConversations([]);\n      setLoading(false);\n    }\n  };\n\n  const fetchAvailableUsers = async () => {\n    try {\n      setLoading(true);\n      const response = await axios.get('/api/messages/users');\n      console.log('Available users response:', response.data);\n      console.log('Current user role:', user?.role);\n      setAvailableUsers(response.data.users || []);\n      setLoading(false);\n    } catch (error) {\n      console.error('Error fetching available users:', error);\n      console.error('Error details:', error.response?.data);\n      console.error('Error status:', error.response?.status);\n      setAvailableUsers([]);\n      setLoading(false);\n    }\n  };\n\n  const fetchMessages = async (conversationId) => {\n    try {\n      const response = await axios.get(`/api/messages/${conversationId}`);\n      setMessages(response.data.messages || []);\n    } catch (error) {\n      console.error('Error fetching messages:', error);\n      console.error('Error details:', error.response?.data);\n      if (error.response?.status === 404) {\n        setMessages([]);\n      }\n    }\n  };\n\n  const startConversation = async (userId) => {\n    try {\n      const response = await axios.get(`/api/messages/conversation/${userId}`);\n      \n      if (!response.data || !response.data.conversation) {\n        throw new Error('Invalid response from server');\n      }\n      \n      const conversation = response.data.conversation;\n      \n      // Find other participant - handle both populated and non-populated cases\n      let otherParticipant = null;\n      if (conversation.participants && conversation.participants.length > 0) {\n        otherParticipant = conversation.participants.find(\n          p => {\n            const participantId = p._id?.toString() || p?.toString();\n            const currentUserId = user._id?.toString() || user._id?.toString();\n            return participantId !== currentUserId;\n          }\n        );\n      }\n      \n      if (!otherParticipant) {\n        console.error('Other participant not found in conversation:', conversation);\n        // Try to get user info from availableUsers\n        const userInfo = availableUsers.find(u => u._id.toString() === userId);\n        if (userInfo) {\n          otherParticipant = userInfo;\n        }\n      }\n      \n      setSelectedConversation({\n        ...conversation,\n        otherParticipant: otherParticipant\n      });\n      fetchMessages(conversation._id);\n    } catch (error) {\n      console.error('Error starting conversation:', error);\n      console.error('Error details:', error.response?.data);\n      \n      let errorMessage = 'Error getting conversation';\n      \n      if (error.response) {\n        // Server responded with error\n        errorMessage = error.response.data?.message || error.response.data?.error || `Error: ${error.response.status}`;\n      } else if (error.request) {\n        // Request made but no response\n        errorMessage = 'Network error. Please check your connection.';\n      } else {\n        // Something else happened\n        errorMessage = error.message || 'An unexpected error occurred';\n      }\n      \n      // Show user-friendly error message\n      alert(errorMessage);\n    }\n  };\n\n  const sendMessage = async (e) => {\n    e.preventDefault();\n    if (!newMessage.trim() || sending) return;\n\n    if (!selectedConversation) {\n      alert('Please select a conversation first');\n      return;\n    }\n\n    setSending(true);\n    try {\n      // Get receiver ID - try multiple methods to ensure we get it\n      let receiverId = null;\n      \n      // Method 1: From otherParticipant (most reliable)\n      if (selectedConversation?.otherParticipant?._id) {\n        receiverId = selectedConversation.otherParticipant._id;\n      }\n      \n      // Method 2: From participants array (populated objects)\n      if (!receiverId && selectedConversation?.participants) {\n        const otherUser = selectedConversation.participants.find(\n          p => {\n            const participantId = p._id?.toString() || p?._id || p?.toString();\n            const currentUserId = user._id?.toString() || user._id;\n            return participantId && participantId !== currentUserId;\n          }\n        );\n        if (otherUser) {\n          receiverId = otherUser._id || otherUser._id?.toString() || otherUser;\n        }\n      }\n\n      // Method 3: If receiverId is still not found, try to extract from string IDs\n      if (!receiverId && selectedConversation?.participants) {\n        const currentUserId = user._id?.toString() || user._id;\n        for (const p of selectedConversation.participants) {\n          const participantId = p._id?.toString() || p?._id || p?.toString();\n          if (participantId && participantId !== currentUserId) {\n            receiverId = participantId;\n            break;\n          }\n        }\n      }\n\n      // Ensure receiverId is a string if found\n      if (receiverId && typeof receiverId !== 'string') {\n        receiverId = receiverId.toString();\n      }\n\n      // Prepare request payload - backend can extract receiverId from conversationId if needed\n      const requestPayload = {\n        conversationId: selectedConversation._id,\n        message: newMessage\n      };\n      \n      // Add receiverId if we found it, but backend can handle without it\n      if (receiverId) {\n        requestPayload.receiverId = receiverId;\n      } else {\n        console.warn('ReceiverId not found, but sending with conversationId only. Backend will extract it.');\n      }\n\n      console.log('Sending message with payload:', requestPayload);\n      const response = await axios.post('/api/messages', requestPayload);\n\n      setMessages(prev => [...prev, response.data.message]);\n      setNewMessage('');\n      fetchConversations(); // Refresh conversations list\n      // Refresh messages to get updated list\n      fetchMessages(selectedConversation._id);\n    } catch (error) {\n      console.error('Error sending message:', error);\n      console.error('Error details:', error.response?.data);\n      alert(error.response?.data?.message || 'Error sending message');\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const formatTime = (date) => {\n    const messageDate = new Date(date);\n    const now = new Date();\n    const diff = now - messageDate;\n    const minutes = Math.floor(diff / 60000);\n\n    if (minutes < 1) return 'Just now';\n    if (minutes < 60) return `${minutes}m ago`;\n    if (minutes < 1440) return `${Math.floor(minutes / 60)}h ago`;\n    return messageDate.toLocaleDateString();\n  };\n\n  useEffect(() => {\n    if (isOpen) {\n      document.body.style.overflow = 'hidden';\n      document.documentElement.style.overflow = 'hidden';\n      document.body.classList.add('chat-open');\n      document.documentElement.classList.add('chat-open');\n    } else {\n      document.body.style.overflow = '';\n      document.documentElement.style.overflow = '';\n      document.body.classList.remove('chat-open');\n      document.documentElement.classList.remove('chat-open');\n    }\n    \n    return () => {\n      document.body.style.overflow = '';\n      document.documentElement.style.overflow = '';\n      document.body.classList.remove('chat-open');\n      document.documentElement.classList.remove('chat-open');\n    };\n  }, [isOpen]);\n\n  if (!isOpen) return null;\n\n  return (\n    <div \n      className=\"chat-overlay\" \n      onClick={onClose}\n      style={{ \n        position: 'fixed', \n        top: 0, \n        left: 0, \n        right: 0, \n        bottom: 0, \n        zIndex: 999999,\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        height: '100vh',\n        width: '100vw'\n      }}\n    >\n      <div \n        className=\"chat-container\" \n        onClick={(e) => e.stopPropagation()}\n        style={{\n          position: 'fixed',\n          top: '50%',\n          left: '50%',\n          transform: 'translate(-50%, -50%)',\n          zIndex: 1000000,\n          margin: 0\n        }}\n      >\n        <div className=\"chat-header\">\n          <h3>Messages</h3>\n          <button className=\"chat-close-btn\" onClick={onClose}>Ã—</button>\n        </div>\n\n        <div className=\"chat-content\">\n          {/* Conversations List */}\n          <div className=\"chat-sidebar\">\n            <div className=\"chat-sidebar-header\">\n              <h4>Conversations</h4>\n              <button\n                className=\"btn btn-primary btn-sm\"\n                onClick={() => setSelectedConversation(null)}\n              >\n                New Chat\n              </button>\n            </div>\n\n            {loading ? (\n              <div className=\"chat-empty\">Loading...</div>\n            ) : !selectedConversation ? (\n              <div className=\"chat-users-list\">\n                <h5>Start a conversation:</h5>\n                {availableUsers.length === 0 ? (\n                  <div className=\"chat-empty\">\n                    <p>No users available to chat</p>\n                    <p style={{ fontSize: '12px', marginTop: '8px', color: '#999' }}>\n                      {user?.role === 'receptionist' ? 'No guests available' : \n                       user?.role === 'guest' ? 'No receptionists available' : \n                       'No users found'}\n                    </p>\n                  </div>\n                ) : (\n                  availableUsers.map(userItem => (\n                    <div\n                      key={userItem._id}\n                      className=\"chat-user-item\"\n                      onClick={() => startConversation(userItem._id)}\n                    >\n                      <div className=\"chat-user-avatar\">\n                        {userItem.firstName?.[0]}{userItem.lastName?.[0]}\n                      </div>\n                      <div className=\"chat-user-info\">\n                        <div className=\"chat-user-name\">\n                          {userItem.firstName} {userItem.lastName}\n                        </div>\n                        <div className=\"chat-user-role\">{userItem.role}</div>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            ) : (\n              <div className=\"chat-conversations-list\">\n                {conversations.length === 0 ? (\n                  <p className=\"chat-empty\">No conversations yet</p>\n                ) : (\n                  conversations.map(conv => {\n                    const otherUser = conv.otherParticipant || conv.participants.find(\n                      p => p._id.toString() !== user._id.toString()\n                    );\n                    return (\n                      <div\n                        key={conv._id}\n                        className={`chat-conversation-item ${\n                          selectedConversation?._id === conv._id ? 'active' : ''\n                        }`}\n                        onClick={async () => {\n                          // Ensure otherParticipant is properly set\n                          let finalOtherUser = otherUser;\n                          if (!finalOtherUser && conv.participants) {\n                            finalOtherUser = conv.participants.find(\n                              p => {\n                                const participantId = p._id?.toString() || p?._id || p?.toString();\n                                const currentUserId = user._id?.toString() || user._id;\n                                return participantId && participantId !== currentUserId;\n                              }\n                            );\n                          }\n                          \n                          const updatedConversation = {\n                            ...conv,\n                            otherParticipant: finalOtherUser,\n                            _id: conv._id\n                          };\n                          \n                          console.log('Selected conversation:', updatedConversation);\n                          setSelectedConversation(updatedConversation);\n                          fetchMessages(conv._id);\n                        }}\n                      >\n                        <div className=\"chat-user-avatar\">\n                          {otherUser?.firstName?.[0]}{otherUser?.lastName?.[0]}\n                        </div>\n                        <div className=\"chat-conversation-info\">\n                          <div className=\"chat-conversation-header\">\n                            <span className=\"chat-conversation-name\">\n                              {otherUser?.firstName} {otherUser?.lastName}\n                            </span>\n                            {conv.unreadCount > 0 && (\n                              <span className=\"chat-unread-badge\">{conv.unreadCount}</span>\n                            )}\n                          </div>\n                          <div className=\"chat-conversation-preview\">\n                            {conv.lastMessage || 'No messages yet'}\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })\n                )}\n              </div>\n            )}\n          </div>\n\n          {/* Messages Area */}\n          <div className=\"chat-messages-area\">\n            {selectedConversation ? (\n              <>\n                <div className=\"chat-messages-header\">\n                  <div className=\"chat-messages-user\">\n                    <div className=\"chat-user-avatar\">\n                      {selectedConversation.otherParticipant?.firstName?.[0]}\n                      {selectedConversation.otherParticipant?.lastName?.[0]}\n                    </div>\n                    <div>\n                      <div className=\"chat-messages-name\">\n                        {selectedConversation.otherParticipant?.firstName}{' '}\n                        {selectedConversation.otherParticipant?.lastName}\n                      </div>\n                      <div className=\"chat-messages-role\">\n                        {selectedConversation.otherParticipant?.role}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"chat-messages-list\" ref={messagesContainerRef}>\n                  {messages.length === 0 ? (\n                    <div className=\"chat-empty-messages\">\n                      No messages yet. Start the conversation!\n                    </div>\n                  ) : (\n                    messages.map(message => {\n                      const isOwn = message.senderId._id === user._id;\n                      return (\n                        <div\n                          key={message._id}\n                          className={`chat-message ${isOwn ? 'own' : 'other'}`}\n                        >\n                          <div className=\"chat-message-content\">\n                            <div className=\"chat-message-text\">{message.message}</div>\n                            <div className=\"chat-message-time\">\n                              {formatTime(message.createdAt)}\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })\n                  )}\n                  <div ref={messagesEndRef} />\n                </div>\n\n                <form className=\"chat-input-form\" onSubmit={sendMessage}>\n                  <input\n                    type=\"text\"\n                    className=\"chat-input\"\n                    placeholder=\"Type a message...\"\n                    value={newMessage}\n                    onChange={(e) => setNewMessage(e.target.value)}\n                    disabled={sending}\n                  />\n                  <button\n                    type=\"submit\"\n                    className=\"chat-send-btn\"\n                    disabled={!newMessage.trim() || sending}\n                  >\n                    Send\n                  </button>\n                </form>\n              </>\n            ) : (\n              <div className=\"chat-welcome\">\n                <div className=\"chat-welcome-icon\">\n                  <svg width=\"48\" height=\"48\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                    <path d=\"M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H6L4 18V4H20V16Z\" fill=\"currentColor\"/>\n                    <path d=\"M7 9H17V11H7V9ZM7 12H15V14H7V12Z\" fill=\"currentColor\"/>\n                  </svg>\n                </div>\n                <h3>Select a conversation or start a new one</h3>\n                <p>Choose from the list on the left to view and send messages</p>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Chat;\n\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}